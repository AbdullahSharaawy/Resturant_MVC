@using Resturant_BLL.DTOModels.ReservationDTOS
 @model List<ReservationDTO>

@{
    Layout = "_ManagementLayout";
}

<h2>Reservations Management</h2>

<div class="container mt-4 pt-5">
    <style>
        /* Make OK button close to black */
        #notificationModal .btn-primary {
            background-color: #212529; /* Bootstrap dark shade */
            border-color: #212529;
        }

            #notificationModal .btn-primary:hover {
                background-color: #000; /* Pure black on hover */
                border-color: #000;
            }
        body {
            background-image: url("@Url.Content("~/Files/3274764.jpg")");
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        #myTable {
            background-color: #212529;
            color: #f8f9fa;
        }
        #myTable thead.thead-dark th {
            background-color: #343a40;
            color: #f8f9fa;
        }
        #myTable tbody tr {
            background-color: #212529;
            color: #f8f9fa;
        }
        #myTable.table-striped tbody tr:nth-of-type(odd) {
            background-color: rgba(0,0,0,.05);
        }
        #myTable.table-hover tbody tr:hover {
            background-color: rgba(255,255,255,.1);
        }
        .action-buttons {
            text-align: center;
            white-space: nowrap;
        }
        .action-buttons svg {
            width: 1.2em;
            height: 1.2em;
            vertical-align: middle;
            fill: #f8f9fa;
            transition: fill 0.2s ease-in-out;
        }
        .action-buttons a:hover svg {
            fill: #adb5bd;
        }
        .btn-outline-light {
            color: #f8f9fa;
            border-color: #f8f9fa;
        }
        .btn-outline-light:hover {
            color: #212529;
            background-color: #f8f9fa;
            border-color: #f8f9fa;
        }
        .btn-outline-danger {
            color: #dc3545;
            border-color: #dc3545;
        }
        .btn-outline-danger:hover {
            color: #f8f9fa;
            background-color: #dc3545;
            border-color: #dc3545;
        }
        .action-buttons .action-icon-btn {
            margin: 0 3px;
            padding: .25rem .5rem;
            line-height: 1;
        }
    </style>
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    <partial name="_NotificationModal" />
    <table id="myTable" class="table table-striped table-hover table-bordered">
        <thead class="thead-dark">
            <tr>
                <th class="text-center">Reservation #</th>
                <th class="text-center">Payment #</th>
                <th class="text-center">User #</th>
                <th class="text-center">Secret Key</th>
                <th class="text-center">Date &amp; Time</th>
                <th class="text-center">Guests</th>
                <th class="text-center">Status</th>
                <th class="text-center">Payment</th>
                <th class="text-center">Cost</th>
                <th class="text-center">Location (City)</th>
                <th class="text-center">Action</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td class="text-center">@item.ReservationID</td>
                    <td class="text-center">@item.PaymentID</td>
                    <td class="text-center">@item.User.FirstName @item.User.LastName</td>
                    <td class="text-center">@item.SecretKey</td>
                    <td class="text-center">@item.DateTime.ToString("MMM dd, yyyy hh:mm tt")</td>
                    <td class="text-center">@item.NumberOfGuests</td>
                   
                    
                   
                    <td class="text-center">@item.Payment.Status</td>
                    <td class="text-center">@item.Payment.PaymentMethod</td>
                    <td class="text-center">@item.Payment.Amount</td>
                    <td class="text-center">@item.Branch.City</td>
                    <td class="text-center action-buttons">
                        <a class="btn btn-sm btn-outline-light action-icon-btn" href="/Reservation/Update?id=@item.ReservationID" title="Edit">
                            <svg viewBox="0 0 40 40" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 25l3 3 15-15-3-3-15 15zM11 26l3 3-4 1z"></path>
                            </svg>
                        </a>
                        <a class="btn btn-sm btn-outline-success action-icon-btn" href="/Reservation/PaymentCompleted?id=@item.ReservationID" title="Mark as Completed">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-check-circle-fill" viewBox="0 0 16 16">
                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z" />
                            </svg>
                        </a>
                        <a class="btn btn-sm btn-outline-danger action-icon-btn" href="#" data-bs-toggle="modal" data-bs-target="#deleteModal" data-item-id="@item.ReservationID" title="Delete">
                            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path d="M5.755,20.283,4,8H20L18.245,20.283A2,2,0,0,1,16.265,22H7.735A2,2,0,0,1,5.755,20.283ZM21,4H16V3a1,1,0,0,0-1-1H9A1,1,0,0,0,8,3V4H3A1,1,0,0,0,3,6H21a1,1,0,0,0,0-2Z"></path>
                            </svg>
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>

    <a class="btn btn-primary bg-dark text-white" href="/Reservation/Create">New</a>
</div>

<!-- Delete modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content bg-dark text-white">
            <div class="modal-header">
                <h5 class="modal-title" id="deleteModalLabel">Confirm Deletion</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                Are you sure you want to delete this reservation?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a id="confirmDeleteButton" href="#" class="btn btn-danger">Delete</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var deleteModal = document.getElementById('deleteModal');
            if (deleteModal) {
                deleteModal.addEventListener('show.bs.modal', function (event) {
                    var button = event.relatedTarget;
                    var itemId = button.getAttribute('data-item-id');
                    var confirmDeleteButton = document.getElementById('confirmDeleteButton');
                    confirmDeleteButton.href = '/Reservation/Delete?id=' + itemId;
                });
            }
        });
    </script>
}
